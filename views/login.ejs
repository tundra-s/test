<%layout('/layout/page') -%>
<% block('title', 'Hello from block') -%>
<% block('header', 'header') -%>
<% block('footer', 'footer') -%>

<p class="lead">Всем привет !</p>

<p>Введите имя пользователя и пароль. Если такого пользователя нет, он будет создан</p>

<form class="form-horisontal login-form" name='login-form' >
	<div class="form-group">
		<label for="input-username" class="col-lg-2 control-label">Имя</label>
		
		<div class="col-lg-10">
			<input type="text" name="username" id="input-username" placeholder="Имя" class="form-control">
		</div>
	</div>
	<div class="form-group">
		<label for="input-password" class="col-lg-2 control-label">Имя</label>
		
		<div class="col-lg-10">
			<input type="password" name="password" id="input-password" value="pass" placeholder="Пароль" class="form-control">
		</div>
	</div>
	<div class="form-group">
		<div class="col-lg-offset-2 col-lg-10">
			<button class="btn btn-primary" data-loading-text="Отправляю ...">Войти</button>
			<span class="help-block error"></span>
		</div>
	</div>
</form>


<script>
	$(document.forms['login-form']).on('submit', function(){
		var form = $(this);



		$('.error', form).html('');
		$(':submit', form).button('loading');

		$.ajax({
			url: '/login',
			method: 'POST',
			data: form.serialize(),
			complete: function(){
				$(":submit", form).button('reset');
			},
			statusCode:{
				200: function(){
					form.html("Вы вошли на сайт").addClass('alert-success');
					window.location.href = '/chat';
				},
				403: function(jqXHR){
					var error = JSON.parse(jqXHR.responseText);
					$('.error', form).html(error.message);
				}
			}
		});

		return false;
	})
</script>